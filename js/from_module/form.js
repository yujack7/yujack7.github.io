(function(b){var a={init:function(c){var d=this;if(!d.data("jqv")||d.data("jqv")==null){c=a._saveOptions(d,c);b(".formError").live("click",function(){b(this).fadeOut(150,function(){b(this).parent(".formErrorOuter").remove();b(this).remove()})})}return this},attach:function(e){if(!b(this).is("form")){alert("Sorry, jqv.attach() only applies to a form");return this}var d=this;var c;if(e){c=a._saveOptions(d,e)}else{c=d.data("jqv")}c.validateAttribute=(d.find("[data-validation-engine*=validate]").length)?"data-validation-engine":"class";if(c.binded){d.find("["+c.validateAttribute+"*=validate]").not("[type=checkbox]").not("[type=radio]").not(".datepicker").bind(c.validationEventTrigger,a._onFieldEvent);d.find("["+c.validateAttribute+"*=validate][type=checkbox],["+c.validateAttribute+"*=validate][type=radio]").bind("click",a._onFieldEvent);d.find("["+c.validateAttribute+"*=validate][class*=datepicker]").bind(c.validationEventTrigger,{delay:300},a._onFieldEvent)}if(c.autoPositionUpdate){b(window).bind("resize",{noAnimation:true,formElem:d},a.updatePromptsPosition)}d.bind("submit",a._onSubmitEvent);return this},detach:function(){if(!b(this).is("form")){alert("Sorry, jqv.detach() only applies to a form");return this}var d=this;var c=d.data("jqv");d.find("["+c.validateAttribute+"*=validate]").not("[type=checkbox]").unbind(c.validationEventTrigger,a._onFieldEvent);d.find("["+c.validateAttribute+"*=validate][type=checkbox],[class*=validate][type=radio]").unbind("click",a._onFieldEvent);d.unbind("submit",a.onAjaxFormComplete);d.find("["+c.validateAttribute+"*=validate]").not("[type=checkbox]").die(c.validationEventTrigger,a._onFieldEvent);d.find("["+c.validateAttribute+"*=validate][type=checkbox]").die("click",a._onFieldEvent);d.die("submit",a.onAjaxFormComplete);d.removeData("jqv");if(c.autoPositionUpdate){b(window).unbind("resize",a.updatePromptsPosition)}return this},validate:function(){var c=b(this);var f=null;if(c.is("form")&&!c.hasClass("validating")){c.addClass("validating");var d=c.data("jqv");f=a._validateFields(this);setTimeout(function(){c.removeClass("validating")},100);if(f&&d.onFormSuccess){d.onFormSuccess()}else{if(!f&&d.onFormFailure){d.onFormFailure()}}}else{if(c.is("form")){c.removeClass("validating")}else{var e=c.closest("form");var d=e.data("jqv");f=a._validateField(c,d);if(f&&d.onFieldSuccess){d.onFieldSuccess()}else{if(d.onFieldFailure&&d.InvalidFields.length>0){d.onFieldFailure()}}}}return f},updatePromptsPosition:function(f){if(f&&this==window){var e=f.data.formElem;var d=f.data.noAnimation}else{var e=b(this.closest("form"))}var c=e.data("jqv");e.find("["+c.validateAttribute+"*=validate]").not(":disabled").each(function(){var i=b(this);var h=a._getPrompt(i);var g=b(h).find(".formErrorContent").html();if(h){a._updatePrompt(i,b(h),g,undefined,false,c,d)}});return this},showPrompt:function(d,f,h,c){var g=this.closest("form");var e=g.data("jqv");if(!e){e=a._saveOptions(this,e)}if(h){e.promptPosition=h}e.showArrow=c==true;a._showPrompt(this,d,f,false,e);return this},hide:function(){var e=b(this).closest("form");var d=e.data("jqv");var c=(d&&d.fadeDuration)?d.fadeDuration:0.3;var f;if(b(this).is("form")){f="parentForm"+a._getClassName(b(this).attr("id"))}else{f=a._getClassName(b(this).attr("id"))+"formError"}b("."+f).fadeTo(c,0.3,function(){b(this).parent(".formErrorOuter").remove();b(this).remove()});return this},hideAll:function(){var d=this;var c=d.data("jqv");var e=c?c.fadeDuration:0.3;b(".formError").fadeTo(e,0.3,function(){b(this).parent(".formErrorOuter").remove();b(this).remove()});return this},_onFieldEvent:function(e){var f=b(this);var d=f.closest("form");var c=d.data("jqv");c.eventTrigger="field";window.setTimeout(function(){a._validateField(f,c);if(c.InvalidFields.length==0&&c.onFieldSuccess){c.onFieldSuccess()}else{if(c.InvalidFields.length>0&&c.onFieldFailure){c.onFieldFailure()}}},(e.data)?e.data.delay:0)},_onSubmitEvent:function(){var e=b(this);var c=e.data("jqv");c.eventTrigger="submit";var d=a._validateFields(e);if(d&&c.ajaxFormValidation){a._validateFormWithAjax(e,c);return false}if(c.onValidationComplete){return !!c.onValidationComplete(e,d)}return d},_checkAjaxStatus:function(c){var d=true;b.each(c.ajaxValidCache,function(e,f){if(!f){d=false;return false}});return d},_checkAjaxFieldStatus:function(d,c){return c.ajaxValidCache[d]==true},_validateFields:function(d){var k=d.data("jqv");var e=false;d.trigger("jqv.form.validating");var m=null;d.find("["+k.validateAttribute+"*=validate]").not(":disabled").each(function(){var p=b(this);var o=[];if(b.inArray(p.attr("name"),o)<0){e|=a._validateField(p,k);if(e&&m==null){if(p.is(":hidden")&&k.prettySelect){m=p=d.find("#"+k.usePrefix+p.attr("id")+k.useSuffix)}else{m=p}}if(k.doNotShowAllErrosOnSubmit){return false}o.push(p.attr("name"));if(k.showOneMessage==true&&e){return false}}});d.trigger("jqv.form.result",[e]);if(e){if(k.scroll){var n=m.offset().top;var h=m.offset().left;var i=k.promptPosition;if(typeof(i)=="string"&&i.indexOf(":")!=-1){i=i.substring(0,i.indexOf(":"))}if(i!="bottomRight"&&i!="bottomLeft"){var g=a._getPrompt(m);if(g){n=g.offset().top}}if(k.isOverflown){var j=b(k.overflownDIV);if(!j.length){return false}var c=j.scrollTop();var f=-parseInt(j.offset().top);n+=c+f-5;var l=b(k.overflownDIV+":not(:animated)");l.animate({scrollTop:n},1100,function(){if(k.focusFirstField){m.focus()}})}else{b("html:not(:animated),body:not(:animated)").animate({scrollTop:n,scrollLeft:h},1100,function(){if(k.focusFirstField){m.focus()}})}}else{if(k.focusFirstField){m.focus()}}return false}return true},_validateFormWithAjax:function(g,e){var h=g.serialize();var f=(e.ajaxmethod)?e.ajaxmethod:"GET";var d=(e.ajaxFormValidationURL)?e.ajaxFormValidationURL:g.attr("action");var c=(e.dataType)?e.dataType:"json";b.ajax({type:f,url:d,cache:false,dataType:c,data:h,form:g,methods:a,options:e,beforeSend:function(){return e.onBeforeAjaxFormValidation(g,e)},error:function(i,j){a._ajaxError(i,j)},success:function(m){if((c=="json")&&(m!==true)){var n=false;for(var l=0;l<m.length;l++){var o=m[l];var p=o[0];var k=b(b("#"+p)[0]);if(k.length==1){var q=o[2];if(o[1]==true){if(q==""||!q){a._closePrompt(k)}else{if(e.allrules[q]){var j=e.allrules[q].alertTextOk;if(j){q=j}}a._showPrompt(k,q,"pass",false,e,true)}}else{n|=true;if(e.allrules[q]){var j=e.allrules[q].alertText;if(j){q=j}}a._showPrompt(k,q,"",false,e,true)}}}e.onAjaxFormComplete(!n,g,m,e)}else{e.onAjaxFormComplete(true,g,m,e)}}})},_validateField:function(d,n,r){if(!d.attr("id")){d.attr("id","form-validation-field-"+b.validationEngine.fieldIdCounter);++b.validationEngine.fieldIdCounter}if(d.is(":hidden")&&!n.prettySelect||d.parent().is(":hidden")){return false}var z=d.attr(n.validateAttribute);var x=/validate\[(.*)\]/.exec(z);if(!x){return false}var t=x[1];var s=t.split(/\[|,|\]/);var j=false;var h=d.attr("name");var g="";var v="";var f=false;var y=false;n.isError=false;n.showArrow=true;if(n.maxErrorsPerField>0){y=true}var c=b(d.closest("form"));for(var u in s){s[u]=s[u].replace(" ","");if(s[u]===""){delete s[u]}}for(var u=0,l=0;u<s.length;u++){if(y&&l>=n.maxErrorsPerField){if(!f){var o=b.inArray("required",s);f=(o!=-1&&o>=u)}break}var e=undefined;switch(s[u]){case"required":f=true;e=a._getErrorMessage(c,d,s[u],s,u,n,a._required);break;case"custom":e=a._getErrorMessage(c,d,s[u],s,u,n,a._custom);break;case"groupRequired":var w="["+n.validateAttribute+"*="+s[u+1]+"]";var q=c.find(w).eq(0);if(q[0]!=d[0]){a._validateField(q,n,r);n.showArrow=true;continue}e=a._getErrorMessage(c,d,s[u],s,u,n,a._groupRequired);if(e){f=true}n.showArrow=false;break;case"ajax":e=a._ajax(d,s,u,n);if(e){v="load"}break;case"minSize":e=a._getErrorMessage(c,d,s[u],s,u,n,a._minSize);break;case"maxSize":e=a._getErrorMessage(c,d,s[u],s,u,n,a._maxSize);break;case"min":e=a._getErrorMessage(c,d,s[u],s,u,n,a._min);break;case"max":e=a._getErrorMessage(c,d,s[u],s,u,n,a._max);break;case"past":e=a._getErrorMessage(c,d,s[u],s,u,n,a._past);break;case"future":e=a._getErrorMessage(c,d,s[u],s,u,n,a._future);break;case"dateRange":var w="["+n.validateAttribute+"*="+s[u+1]+"]";n.firstOfGroup=c.find(w).eq(0);n.secondOfGroup=c.find(w).eq(1);if(n.firstOfGroup[0].value||n.secondOfGroup[0].value){e=a._getErrorMessage(c,d,s[u],s,u,n,a._dateRange)}if(e){f=true}n.showArrow=false;break;case"dateTimeRange":var w="["+n.validateAttribute+"*="+s[u+1]+"]";n.firstOfGroup=c.find(w).eq(0);n.secondOfGroup=c.find(w).eq(1);if(n.firstOfGroup[0].value||n.secondOfGroup[0].value){e=a._getErrorMessage(c,d,s[u],s,u,n,a._dateTimeRange)}if(e){f=true}n.showArrow=false;break;case"maxCheckbox":d=b(c.find("input[name='"+h+"']"));e=a._getErrorMessage(c,d,s[u],s,u,n,a._maxCheckbox);break;case"minCheckbox":d=b(c.find("input[name='"+h+"']"));e=a._getErrorMessage(c,d,s[u],s,u,n,a._minCheckbox);break;case"equals":e=a._getErrorMessage(c,d,s[u],s,u,n,a._equals);break;case"funcCall":e=a._getErrorMessage(c,d,s[u],s,u,n,a._funcCall);break;case"creditCard":e=a._getErrorMessage(c,d,s[u],s,u,n,a._creditCard);break;case"condRequired":e=a._getErrorMessage(c,d,s[u],s,u,n,a._condRequired);if(e!==undefined){f=true}break;default:}var k=false;if(typeof e=="object"){switch(e.status){case"_break":k=true;break;case"_error":e=e.message;break;case"_error_no_prompt":return true;break;default:break}}if(k){break}if(typeof e=="string"){g+=e+"<br/>";n.isError=true;l++}}if(!f&&d.val().length<1){n.isError=false}var m=d.prop("type");if((m=="radio"||m=="checkbox")&&c.find("input[name='"+h+"']").size()>1){d=b(c.find("input[name='"+h+"'][type!=hidden]:first"));n.showArrow=false}if(d.is(":hidden")&&n.prettySelect){d=c.find("#"+n.usePrefix+d.attr("id")+n.useSuffix)}if(n.isError){a._showPrompt(d,g,v,false,n)}else{if(!j){a._closePrompt(d)}}if(!j){d.trigger("jqv.field.result",[d,n.isError,g])}var p=b.inArray(d[0],n.InvalidFields);if(p==-1){if(n.isError){n.InvalidFields.push(d[0])}}else{if(!n.isError){n.InvalidFields.splice(p,1)}}return n.isError},_getErrorMessage:function(c,n,m,p,f,l,q){var k=m;if(m=="custom"){var j=jQuery.inArray(m,p)+1;var o=p[j];m="custom["+o+"]"}var e=(n.attr("data-validation-engine"))?n.attr("data-validation-engine"):n.attr("class");var g=e.split(" ");var h;if(m=="future"||m=="past"||m=="maxCheckbox"||m=="minCheckbox"){h=q(c,n,p,f,l)}else{h=q(n,p,f,l)}if(h!=undefined){var d=a._getCustomErrorMessage(b(n),g,k,l);if(d){h=d}}return h},_getCustomErrorMessage:function(k,d,j,h){var e=false;var g=a._validityProp[j];if(g!=undefined){e=k.attr("data-errormessage-"+g);if(e!=undefined){return e}}e=k.attr("data-errormessage");if(e!=undefined){return e}var c="#"+k.attr("id");if(typeof h.custom_error_messages[c]!="undefined"&&typeof h.custom_error_messages[c][j]!="undefined"){e=h.custom_error_messages[c][j]["message"]}else{if(d.length>0){for(var f=0;f<d.length&&d.length>0;f++){var l="."+d[f];if(typeof h.custom_error_messages[l]!="undefined"&&typeof h.custom_error_messages[l][j]!="undefined"){e=h.custom_error_messages[l][j]["message"];break}}}}if(!e&&typeof h.custom_error_messages[j]!="undefined"&&typeof h.custom_error_messages[j]["message"]!="undefined"){e=h.custom_error_messages[j]["message"]}return e},_validityProp:{required:"value-missing",custom:"custom-error",groupRequired:"value-missing",ajax:"custom-error",minSize:"range-underflow",maxSize:"range-overflow",min:"range-underflow",max:"range-overflow",past:"type-mismatch",future:"type-mismatch",dateRange:"type-mismatch",dateTimeRange:"type-mismatch",maxCheckbox:"range-overflow",minCheckbox:"range-underflow",equals:"pattern-mismatch",funcCall:"custom-error",creditCard:"pattern-mismatch",condRequired:"value-missing"},_required:function(g,h,e,d){switch(g.prop("type")){case"text":case"password":case"textarea":case"file":case"select-one":case"select-multiple":default:if(!b.trim(g.val())||g.val()==g.attr("data-validation-placeholder")||g.val()==g.attr("placeholder")){return d.allrules[h[e]].alertText}break;case"radio":case"checkbox":var f=g.closest("form");var c=g.attr("name");if(f.find("input[name='"+c+"']:checked").size()==0){if(f.find("input[name='"+c+"']:visible").size()==1){return d.allrules[h[e]].alertTextCheckboxe}else{return d.allrules[h[e]].alertTextCheckboxMultiple}}break}},_groupRequired:function(f,h,d,c){var g="["+c.validateAttribute+"*="+h[d+1]+"]";var e=false;f.closest("form").find(g).each(function(){if(!a._required(b(this),h,d,c)){e=true;return false}});if(!e){return c.allrules[h[d]].alertText}},_custom:function(k,l,d,g){var e=l[d+1];var j=g.allrules[e];var h;if(!j){return}if(j.regex){var f=j.regex;if(!f){alert("jqv:custom regex not found - "+e);return}var c=new RegExp(f);if(!c.test(k.val())){return g.allrules[e].alertText}}else{if(j.func){h=j.func;if(typeof(h)!=="function"){alert("jqv:custom parameter 'function' is no function - "+e);return}if(!h(k,l,d,g)){return g.allrules[e].alertText}}else{alert("jqv:custom type not allowed "+e);return}}},_funcCall:function(j,k,e,d){var c=k[e+1];var g;if(c.indexOf(".")>-1){var h=c.split(".");var f=window;while(h.length){f=f[h.shift()]}g=f}else{g=window[c]||d.customFunctions[c]}if(typeof(g)=="function"){return g(j,k,e,d)}},_equals:function(f,g,d,c){var e=g[d+1];if(f.val()!=b("#"+e).val()){return c.allrules.equals.alertText}},_maxSize:function(h,j,f,e){var d=j[f+1];var c=h.val().length;if(c>d){var g=e.allrules.maxSize;return g.alertText+d+g.alertText2}},_minSize:function(h,j,f,e){var d=j[f+1];var c=h.val().length;if(c<d){var g=e.allrules.minSize;return g.alertText+d+g.alertText2}},_min:function(h,j,f,e){var d=parseFloat(j[f+1]);var c=parseFloat(h.val());if(c<d){var g=e.allrules.min;if(g.alertText2){return g.alertText+d+g.alertText2}return g.alertText+d}},_max:function(h,j,f,e){var d=parseFloat(j[f+1]);var c=parseFloat(h.val());if(c>d){var g=e.allrules.max;if(g.alertText2){return g.alertText+d+g.alertText2}return g.alertText+d}},_past:function(d,k,l,f,j){var e=l[f+1];var c=b(d.find("input[name='"+e.replace(/^#+/,"")+"']"));var g;if(e.toLowerCase()=="now"){g=new Date()}else{if(undefined!=c.val()){if(c.is(":disabled")){return}g=a._parseDate(c.val())}else{g=a._parseDate(e)}}var m=a._parseDate(k.val());if(m>g){var h=j.allrules.past;if(h.alertText2){return h.alertText+a._dateToString(g)+h.alertText2}return h.alertText+a._dateToString(g)}},_future:function(d,k,l,f,j){var e=l[f+1];var c=b(d.find("input[name='"+e.replace(/^#+/,"")+"']"));var g;if(e.toLowerCase()=="now"){g=new Date()}else{if(undefined!=c.val()){if(c.is(":disabled")){return}g=a._parseDate(c.val())}else{g=a._parseDate(e)}}var m=a._parseDate(k.val());if(m<g){var h=j.allrules.future;if(h.alertText2){return h.alertText+a._dateToString(g)+h.alertText2}return h.alertText+a._dateToString(g)}},_isDate:function(d){var c=new RegExp(/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(?:(?:0?[1-9]|1[0-2])(\/|-)(?:0?[1-9]|1\d|2[0-8]))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(0?2(\/|-)29)(\/|-)(?:(?:0[48]00|[13579][26]00|[2468][048]00)|(?:\d\d)?(?:0[48]|[2468][048]|[13579][26]))$/);return c.test(d)},_isDateTime:function(d){var c=new RegExp(/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1}$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^((1[012]|0?[1-9]){1}\/(0?[1-9]|[12][0-9]|3[01]){1}\/\d{2,4}\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1})$/);return c.test(d)},_dateCompare:function(d,c){return(new Date(d.toString())<new Date(c.toString()))},_dateRange:function(e,f,d,c){if((!c.firstOfGroup[0].value&&c.secondOfGroup[0].value)||(c.firstOfGroup[0].value&&!c.secondOfGroup[0].value)){return c.allrules[f[d]].alertText+c.allrules[f[d]].alertText2}if(!a._isDate(c.firstOfGroup[0].value)||!a._isDate(c.secondOfGroup[0].value)){return c.allrules[f[d]].alertText+c.allrules[f[d]].alertText2}if(!a._dateCompare(c.firstOfGroup[0].value,c.secondOfGroup[0].value)){return c.allrules[f[d]].alertText+c.allrules[f[d]].alertText2}},_dateTimeRange:function(e,f,d,c){if((!c.firstOfGroup[0].value&&c.secondOfGroup[0].value)||(c.firstOfGroup[0].value&&!c.secondOfGroup[0].value)){return c.allrules[f[d]].alertText+c.allrules[f[d]].alertText2}if(!a._isDateTime(c.firstOfGroup[0].value)||!a._isDateTime(c.secondOfGroup[0].value)){return c.allrules[f[d]].alertText+c.allrules[f[d]].alertText2}if(!a._dateCompare(c.firstOfGroup[0].value,c.secondOfGroup[0].value)){return c.allrules[f[d]].alertText+c.allrules[f[d]].alertText2}},_maxCheckbox:function(g,j,k,e,d){var c=k[e+1];var f=j.attr("name");var h=g.find("input[name='"+f+"']:checked").size();if(h>c){d.showArrow=false;if(d.allrules.maxCheckbox.alertText2){return d.allrules.maxCheckbox.alertText+" "+c+" "+d.allrules.maxCheckbox.alertText2}return d.allrules.maxCheckbox.alertText}},_minCheckbox:function(g,j,k,e,d){var c=k[e+1];var f=j.attr("name");var h=g.find("input[name='"+f+"']:checked").size();if(h<c){d.showArrow=false;return d.allrules.minCheckbox.alertText+" "+c+" "+d.allrules.minCheckbox.alertText2}},_creditCard:function(l,m,f,k){var c=false,n=l.val().replace(/ +/g,"").replace(/-+/g,"");var d=n.length;if(d>=14&&d<=16&&parseInt(n)>0){var g=0,f=d-1,j=1,h,e=new String();do{h=parseInt(n.charAt(f));e+=(j++%2==0)?h*2:h}while(--f>=0);for(f=0;f<e.length;f++){g+=parseInt(e.charAt(f))}c=g%10==0}if(!c){return k.allrules.creditCard.alertText}},_ajax:function(p,s,l,n){var r=s[l+1];var o=n.allrules[r];var k=o.extraData;var m=o.extraDataDynamic;var j={fieldId:p.attr("id"),fieldValue:p.val()};if(typeof k==="object"){b.extend(j,k)}else{if(typeof k==="string"){var f=k.split("&");for(var l=0;l<f.length;l++){var q=f[l].split("=");if(q[0]&&q[0]){j[q[0]]=q[1]}}}}if(m){var g=[];var c=String(m).split(",");for(var l=0;l<c.length;l++){var d=c[l];if(b(d).length){var e=p.closest("form").find(d).val();var h=d.replace("#","")+"="+escape(e);j[d.replace("#","")]=e}}}if(n.eventTrigger=="field"){delete (n.ajaxValidCache[p.attr("id")])}if(!n.isError&&!a._checkAjaxFieldStatus(p.attr("id"),n)){b.ajax({type:n.ajaxFormValidationMethod,url:o.url,cache:false,dataType:"json",data:j,field:p,rule:o,methods:a,options:n,beforeSend:function(){},error:function(i,t){a._ajaxError(i,t)},success:function(u){var w=u[0];var t=b(b("input[id='"+w+"']")[0]);if(t.length==1){var v=u[1];var x=u[2];if(!v){n.ajaxValidCache[w]=false;n.isError=true;if(x){if(n.allrules[x]){var i=n.allrules[x].alertText;if(i){x=i}}}else{x=o.alertText}a._showPrompt(t,x,"",true,n)}else{n.ajaxValidCache[w]=true;if(x){if(n.allrules[x]){var i=n.allrules[x].alertTextOk;if(i){x=i}}}else{x=o.alertTextOk}if(x){a._showPrompt(t,x,"pass",true,n)}else{a._closePrompt(t)}if(n.eventTrigger=="submit"){p.closest("form").submit()}}}t.trigger("jqv.field.result",[t,n.isError,x])}});return o.alertTextLoad}},_ajaxError:function(c,d){if(c.status==0&&d==null){alert("The page is not served from a server! ajax call failed")}else{if(typeof console!="undefined"){console.log("Ajax error: "+c.status+" "+d)}}},_dateToString:function(c){return c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()},_parseDate:function(e){var c=e.split("-");if(c==e){c=e.split("/")}return new Date(c[0],(c[1]-1),c[2])},_showPrompt:function(i,c,g,e,d,f){var h=a._getPrompt(i);if(f){h=false}if(h){a._updatePrompt(i,h,c,g,e,d)}else{a._buildPrompt(i,c,g,e,d)}},_buildPrompt:function(j,c,f,l,h){var e=b("<div>");e.addClass(a._getClassName(j.attr("id"))+"formError");e.addClass("parentForm"+a._getClassName(j.parents("form").attr("id")));e.addClass("formError");switch(f){case"pass":e.addClass("greenPopup");break;case"load":e.addClass("blackPopup");break;default:}if(l){e.addClass("ajaxed")}var i=b("<div>").addClass("formErrorContent").html(c).appendTo(e);if(h.showArrow){var k=b("<div>").addClass("formErrorArrow");var d=j.data("promptPosition")||h.promptPosition;if(typeof(d)=="string"){var g=d.indexOf(":");if(g!=-1){d=d.substring(0,g)}}switch(d){case"bottomLeft":case"bottomRight":e.find(".formErrorContent").before(k);k.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --></div><div class="line2"><!-- --></div><div class="line3"><!-- --></div><div class="line4"><!-- --></div><div class="line5"><!-- --></div><div class="line6"><!-- --></div><div class="line7"><!-- --></div><div class="line8"><!-- --></div><div class="line9"><!-- --></div><div class="line10"><!-- --></div>');break;case"topLeft":case"topRight":k.html('<div class="line10"><!-- --></div><div class="line9"><!-- --></div><div class="line8"><!-- --></div><div class="line7"><!-- --></div><div class="line6"><!-- --></div><div class="line5"><!-- --></div><div class="line4"><!-- --></div><div class="line3"><!-- --></div><div class="line2"><!-- --></div><div class="line1"><!-- --></div>');e.append(k);break}}if(j.closest(".ui-dialog").length){e.addClass("formErrorInsideDialog")}e.css({opacity:0,position:"absolute"});j.before(e);var g=a._calculatePosition(j,e,h);e.css({top:g.callerTopPosition,left:g.callerleftPosition,marginTop:g.marginTopSize,opacity:0}).data("callerField",j);if(h.autoHidePrompt){setTimeout(function(){e.animate({opacity:0},function(){e.closest(".formErrorOuter").remove();e.remove()})},h.autoHideDelay)}return e.animate({opacity:0.87})},_updatePrompt:function(j,f,c,g,k,h,d){if(f){if(typeof g!=="undefined"){if(g=="pass"){f.addClass("greenPopup")}else{f.removeClass("greenPopup")}if(g=="load"){f.addClass("blackPopup")}else{f.removeClass("blackPopup")}}if(k){f.addClass("ajaxed")}else{f.removeClass("ajaxed")}f.find(".formErrorContent").html(c);var i=a._calculatePosition(j,f,h);var e={top:i.callerTopPosition,left:i.callerleftPosition,marginTop:i.marginTopSize};if(d){f.css(e)}else{f.animate(e)}}},_closePrompt:function(d){var c=a._getPrompt(d);if(c){c.fadeTo("fast",0,function(){c.parent(".formErrorOuter").remove();c.remove()})}},closePrompt:function(c){return a._closePrompt(c)},_getPrompt:function(e){var f=b(e).closest("form").attr("id");var c=a._getClassName(e.attr("id"))+"formError";var d=b("."+a._escapeExpression(c)+".parentForm"+f)[0];if(d){return b(d)}},_escapeExpression:function(c){return c.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1")},isRTL:function(e){var f=b(document);var c=b("body");var d=(e&&e.hasClass("rtl"))||(e&&(e.attr("dir")||"").toLowerCase()==="rtl")||f.hasClass("rtl")||(f.attr("dir")||"").toLowerCase()==="rtl"||c.hasClass("rtl")||(c.attr("dir")||"").toLowerCase()==="rtl";return Boolean(d)},_calculatePosition:function(n,h,m){var j,r,e;var i=n.width();var c=n.position().left;var o=n.position().top;var d=n.height();var l=h.height();j=r=0;e=-l;var k=n.data("promptPosition")||m.promptPosition;var f="";var g="";var p=0;var q=0;if(typeof(k)=="string"){if(k.indexOf(":")!=-1){f=k.substring(k.indexOf(":")+1);k=k.substring(0,k.indexOf(":"));if(f.indexOf(",")!=-1){g=f.substring(f.indexOf(",")+1);f=f.substring(0,f.indexOf(","));q=parseInt(g);if(isNaN(q)){q=0}}p=parseInt(f);if(isNaN(f)){f=0}}}switch(k){default:case"topRight":r+=c+i-30;j+=o;break;case"topLeft":j+=o;r+=c;break;case"centerRight":j=o+4;e=0;r=c+n.outerWidth(true)+5;break;case"centerLeft":r=c-(h.width()+2);j=o+4;e=0;break;case"bottomLeft":j=o+n.height()+5;e=0;r=c;break;case"bottomRight":r=c+i-30;j=o+n.height()+5;e=0}r+=p;j+=q;return{callerTopPosition:j+"px",callerleftPosition:r+"px",marginTopSize:e+"px"}},_saveOptions:function(e,d){if(b.validationEngineLanguage){var c=b.validationEngineLanguage.allRules}else{b.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page")}b.validationEngine.defaults.allrules=c;var f=b.extend(true,{},b.validationEngine.defaults,d);e.data("jqv",f);return f},_getClassName:function(c){if(c){return c.replace(/:/g,"_").replace(/\./g,"_")}},_condRequired:function(g,h,e,d){var c,f;for(c=(e+1);c<h.length;c++){f=jQuery("#"+h[c]).first();if(f.length&&a._required(f,["required"],0,d)==undefined){return a._required(g,["required"],0,d)}}}};b.fn.validationEngine=function(d){var c=b(this);if(!c[0]){return c}if(typeof(d)=="string"&&d.charAt(0)!="_"&&a[d]){if(d!="showPrompt"&&d!="hide"&&d!="hideAll"){a.init.apply(c)}return a[d].apply(c,Array.prototype.slice.call(arguments,1))}else{if(typeof d=="object"||!d){a.init.apply(c,arguments);return a.attach.apply(c)}else{b.error("Method "+d+" does not exist in jQuery.validationEngine")}}};b.validationEngine={fieldIdCounter:0,defaults:{validationEventTrigger:"blur",scroll:true,focusFirstField:true,promptPosition:"topRight",bindMethod:"bind",inlineAjax:false,ajaxFormValidation:false,ajaxFormValidationURL:false,ajaxFormValidationMethod:"get",onAjaxFormComplete:b.noop,onBeforeAjaxFormValidation:b.noop,onValidationComplete:false,doNotShowAllErrosOnSubmit:false,custom_error_messages:{},binded:true,showArrow:true,isError:false,maxErrorsPerField:false,ajaxValidCache:{},autoPositionUpdate:false,InvalidFields:[],onFieldSuccess:false,onFieldFailure:false,onFormSuccess:false,onFormFailure:false,autoHidePrompt:false,autoHideDelay:10000,fadeDuration:0.3,prettySelect:false,usePrefix:"",useSuffix:"",showOneMessage:false}};b(function(){b.validationEngine.defaults.promptPosition=a.isRTL()?"topLeft":"topRight"})})(jQuery);
/*时间插件*/
Calendar=function(d,b,f,e){this.activeDiv=null;this.currentDateEl=null;this.checkDisabled=null;this.timeout=null;this.onSelected=f||null;this.onClose=e||null;this.dragging=false;this.hidden=false;this.minYear=1970;this.maxYear=2050;this.dateFormat=Calendar._TT.DEF_DATE_FORMAT;this.ttDateFormat=Calendar._TT.TT_DATE_FORMAT;this.isPopup=true;this.weekNumbers=false;this.mondayFirst=d;this.dateStr=b;this.ar_days=null;this.table=null;this.element=null;this.tbody=null;this.firstdayname=null;this.monthsCombo=null;this.yearsCombo=null;this.hilitedMonth=null;this.activeMonth=null;this.hilitedYear=null;this.activeYear=null;this.dateClicked=false;if(!Calendar._DN3){var a=new Array();for(var c=8;c>0;){a[--c]=Calendar._DN[c].substr(0,3)}Calendar._DN3=a;a=new Array();for(var c=12;c>0;){a[--c]=Calendar._MN[c].substr(0,3)}Calendar._MN3=a}};Calendar._C=null;Calendar.is_ie=(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent));Calendar._DN3=null;Calendar._MN3=null;Calendar.getAbsolutePos=function(b){var c={x:b.offsetLeft,y:b.offsetTop};if(b.offsetParent){var a=Calendar.getAbsolutePos(b.offsetParent);c.x+=a.x;c.y+=a.y}return c};Calendar.isRelated=function(c,a){var d=a.relatedTarget;if(!d){var b=a.type;if(b=="mouseover"){d=a.fromElement}else{if(b=="mouseout"){d=a.toElement}}}while(d){if(d==c){return true}d=d.parentNode}return false};Calendar.removeClass=function(e,c){if(!(e&&e.className)){return}var a=e.className.split(" ");var b=new Array();for(var d=a.length;d>0;){if(a[--d]!=c){b[b.length]=a[d]}}e.className=b.join(" ")};Calendar.addClass=function(b,a){Calendar.removeClass(b,a);b.className+=" "+a};Calendar.getElement=function(a){if(Calendar.is_ie){return window.event.srcElement}else{return a.currentTarget}};Calendar.getTargetElement=function(a){if(Calendar.is_ie){return window.event.srcElement}else{return a.target}};Calendar.stopEvent=function(a){if(Calendar.is_ie){window.event.cancelBubble=true;window.event.returnValue=false}else{a.preventDefault();a.stopPropagation()}return false};Calendar.addEvent=function(b,a,c){if(b.attachEvent){b.attachEvent("on"+a,c)}else{if(b.addEventListener){b.addEventListener(a,c,true)}else{b["on"+a]=c}}};Calendar.removeEvent=function(b,a,c){if(b.detachEvent){b.detachEvent("on"+a,c)}else{if(b.removeEventListener){b.removeEventListener(a,c,true)}else{b["on"+a]=null}}};Calendar.createElement=function(c,a){var b=null;if(document.createElementNS){b=document.createElementNS("http://www.w3.org/1999/xhtml",c)}else{b=document.createElement(c)}if(typeof a!="undefined"){a.appendChild(b)}return b};Calendar._add_evs=function(el){with(Calendar){addEvent(el,"mouseover",dayMouseOver);addEvent(el,"mousedown",dayMouseDown);addEvent(el,"mouseout",dayMouseOut);if(is_ie){addEvent(el,"dblclick",dayMouseDblClick);el.setAttribute("unselectable",true)}}};Calendar.findMonth=function(a){if(typeof a.month!="undefined"){return a}else{if(typeof a.parentNode.month!="undefined"){return a.parentNode}}return null};Calendar.findYear=function(a){if(typeof a.year!="undefined"){return a}else{if(typeof a.parentNode.year!="undefined"){return a.parentNode}}return null};Calendar.showMonthsCombo=function(){var c=Calendar._C;if(!c){return false}var c=c;var d=c.activeDiv;var b=c.monthsCombo;if(c.hilitedMonth){Calendar.removeClass(c.hilitedMonth,"hilite")}if(c.activeMonth){Calendar.removeClass(c.activeMonth,"active")}var a=c.monthsCombo.getElementsByTagName("div")[c.date.getMonth()];Calendar.addClass(a,"active");c.activeMonth=a;b.style.left=d.offsetLeft+"px";b.style.top=(d.offsetTop+d.offsetHeight)+"px";b.style.display="block"};Calendar.showYearsCombo=function(c){var e=Calendar._C;if(!e){return false}var e=e;var g=e.activeDiv;var h=e.yearsCombo;if(e.hilitedYear){Calendar.removeClass(e.hilitedYear,"hilite")}if(e.activeYear){Calendar.removeClass(e.activeYear,"active")}e.activeYear=null;var f=e.date.getFullYear()+(c?1:-1);var d=h.firstChild;var a=false;for(var b=12;b>0;--b){if(f>=e.minYear&&f<=e.maxYear){d.firstChild.data=f;d.year=f;d.style.display="block";a=true}else{d.style.display="none"}d=d.nextSibling;f+=c?2:-2}if(a){h.style.left=g.offsetLeft+"px";h.style.top=(g.offsetTop+g.offsetHeight)+"px";h.style.display="block"}};Calendar.tableMouseUp=function(ev){var cal=Calendar._C;if(!cal){return false}if(cal.timeout){clearTimeout(cal.timeout)}var el=cal.activeDiv;if(!el){return false}var target=Calendar.getTargetElement(ev);Calendar.removeClass(el,"active");if(target==el||target.parentNode==el){Calendar.cellClick(el)}var mon=Calendar.findMonth(target);var date=null;if(mon){date=new Date(cal.date);if(mon.month!=date.getMonth()){date.setMonth(mon.month);cal.setDate(date);cal.dateClicked=false;cal.callHandler()}}else{var year=Calendar.findYear(target);if(year){date=new Date(cal.date);if(year.year!=date.getFullYear()){date.setFullYear(year.year);cal.setDate(date);cal.dateClicked=false;cal.callHandler()}}}with(Calendar){removeEvent(document,"mouseup",tableMouseUp);removeEvent(document,"mouseover",tableMouseOver);removeEvent(document,"mousemove",tableMouseOver);cal._hideCombos();_C=null;return stopEvent(ev)}};Calendar.tableMouseOver=function(d){var e=Calendar._C;if(!e){return}var c=e.activeDiv;var f=Calendar.getTargetElement(d);if(f==c||f.parentNode==c){Calendar.addClass(c,"hilite active");Calendar.addClass(c.parentNode,"rowhilite")}else{Calendar.removeClass(c,"active");Calendar.removeClass(c,"hilite");Calendar.removeClass(c.parentNode,"rowhilite")}var b=Calendar.findMonth(f);if(b){if(b.month!=e.date.getMonth()){if(e.hilitedMonth){Calendar.removeClass(e.hilitedMonth,"hilite")}Calendar.addClass(b,"hilite");e.hilitedMonth=b}else{if(e.hilitedMonth){Calendar.removeClass(e.hilitedMonth,"hilite")}}}else{var a=Calendar.findYear(f);if(a){if(a.year!=e.date.getFullYear()){if(e.hilitedYear){Calendar.removeClass(e.hilitedYear,"hilite")}Calendar.addClass(a,"hilite");e.hilitedYear=a}else{if(e.hilitedYear){Calendar.removeClass(e.hilitedYear,"hilite")}}}}return Calendar.stopEvent(d)};Calendar.tableMouseDown=function(a){if(Calendar.getTargetElement(a)==Calendar.getElement(a)){return Calendar.stopEvent(a)}};Calendar.calDragIt=function(b){var c=Calendar._C;if(!(c&&c.dragging)){return false}var e;var d;if(Calendar.is_ie){d=window.event.clientY+document.body.scrollTop;e=window.event.clientX+document.body.scrollLeft}else{e=b.pageX;d=b.pageY}c.hideShowCovered();var a=c.element.style;a.left=(e-c.xOffs)+"px";a.top=(d-c.yOffs)+"px";return Calendar.stopEvent(b)};Calendar.calDragEnd=function(ev){var cal=Calendar._C;if(!cal){return false}cal.dragging=false;with(Calendar){removeEvent(document,"mousemove",calDragIt);removeEvent(document,"mouseover",stopEvent);removeEvent(document,"mouseup",calDragEnd);tableMouseUp(ev)}cal.hideShowCovered()};Calendar.dayMouseDown=function(ev){var el=Calendar.getElement(ev);if(el.disabled){return false}if(el.id=="objclose"||el.id=="objmprev"||el.id=="objmnext"||el.id=="objyprev"||el.id=="objynext"){el=el.parentNode}var cal=el.calendar;cal.activeDiv=el;Calendar._C=cal;if(el.navtype!=300){with(Calendar){addClass(el,"hilite active");addEvent(document,"mouseover",tableMouseOver);addEvent(document,"mousemove",tableMouseOver);addEvent(document,"mouseup",tableMouseUp)}}else{if(cal.isPopup){cal._dragStart(ev)}}if(el.navtype==-1||el.navtype==1){cal.timeout=setTimeout("Calendar.showMonthsCombo()",250)}else{if(el.navtype==-2||el.navtype==2){cal.timeout=setTimeout((el.navtype>0)?"Calendar.showYearsCombo(true)":"Calendar.showYearsCombo(false)",250)}else{cal.timeout=null}}return Calendar.stopEvent(ev)};Calendar.dayMouseDblClick=function(a){return;Calendar.cellClick(Calendar.getElement(a));if(Calendar.is_ie){document.selection.empty()}};Calendar.dayMouseOver=function(ev){var el=Calendar.getElement(ev);if(Calendar.isRelated(el,ev)||Calendar._C||el.disabled){return false}if(el.id=="objclose"||el.id=="objmprev"||el.id=="objmnext"||el.id=="objyprev"||el.id=="objynext"){el=el.parentNode}if(el.ttip){if(el.ttip.substr(0,1)=="_"){var date=null;with(el.calendar.date){date=new Date(getFullYear(),getMonth(),el.caldate)}el.ttip="星期"+date.print("D")+"  "+date.print("y")+"年 "+date.print("M")+date.print("d")+"日"}el.calendar.tooltips.firstChild.data=el.ttip}if(el.navtype!=300){Calendar.addClass(el,"hilite");if(el.caldate){Calendar.addClass(el.parentNode,"rowhilite")}}return Calendar.stopEvent(ev)};Calendar.dayMouseOut=function(ev){with(Calendar){var el=getElement(ev);if(isRelated(el,ev)||_C||el.disabled){return false}removeClass(el,"hilite");if(el.caldate){removeClass(el.parentNode,"rowhilite")}return stopEvent(ev)}};Calendar.cellClick=function(f){var g=f.calendar;var c=false;var b=false;var a=null;if(typeof f.navtype=="undefined"){Calendar.removeClass(g.currentDateEl,"selected");Calendar.addClass(f,"selected");c=(g.currentDateEl==f);if(!c){g.currentDateEl=f}g.date.setDate(f.caldate);a=g.date;b=true;g.dateClicked=true;g.callCloseHandler()}else{if(f.navtype==200){Calendar.removeClass(f,"hilite");g.callCloseHandler();return}a=(f.navtype==0)?new Date():new Date(g.date);g.dateClicked=(f.navtype==0);var e=a.getFullYear();var d=a.getMonth();function h(j){var k=a.getDate();var i=a.getMonthDays(j);if(k>i){a.setDate(i)}a.setMonth(j)}switch(f.navtype){case -2:if(e>g.minYear){a.setFullYear(e-1)}break;case -1:if(d>0){h(d-1)}else{if(e-->g.minYear){a.setFullYear(e);h(11)}}break;case 1:if(d<11){h(d+1)}else{if(e<g.maxYear){a.setFullYear(e+1);h(0)}}break;case 2:if(e<g.maxYear){a.setFullYear(e+1)}break;case 100:g.setMondayFirst(!g.mondayFirst);return;case 0:if((typeof g.checkDisabled=="function")&&g.checkDisabled(a)){return false}break}if(!a.equalsTo(g.date)){g.setDate(a);b=true}}if(b){g.callHandler()}if(c){Calendar.removeClass(f,"hilite");g.callCloseHandler()}};Calendar.prototype.create=function(n){var d=null;if(!n){d=document.getElementsByTagName("body")[0];this.isPopup=true}else{d=n;this.isPopup=false}this.date=this.dateStr?new Date(this.dateStr):new Date();var u=Calendar.createElement("table");this.table=u;u.cellSpacing=0;u.cellPadding=0;u.calendar=this;Calendar.addEvent(u,"mousedown",Calendar.tableMouseDown);var m=Calendar.createElement("div");this.element=m;m.className="calendar";if(this.isPopup){m.style.position="absolute";m.style.zIndex="100";m.style.display="none"}m.appendChild(u);var t=Calendar.createElement("thead",u);var c=null;var g=null;var k=this;var f=function(v,j,i){c=Calendar.createElement("td",g);c.colSpan=j;c.className="rili_button";Calendar._add_evs(c);c.calendar=k;c.navtype=i;if(v.substr(0,1)!="&"){if(v.substr(0,5)=="<img "){c.innerHTML=v}else{c.appendChild(document.createTextNode(v))}}else{c.innerHTML=v}return c};g=Calendar.createElement("tr",t);g.className="headrow";var b=Calendar.createElement("td",g);b.colSpan=7;b.height=26;var s=Calendar.createElement("table",b);s.cellSpacing=0;s.cellPadding=0;s.width="100%";var h=Calendar.createElement("thead",s);g=Calendar.createElement("tr",h);g.className="headrow";this._nav_py=f('<img id=objyprev src="/js/calendar/images/yprev.gif">',1,-2);this._nav_py.width=25;this._nav_py.ttip=Calendar._TT.PREV_YEAR;this.title=f("",1,300);this.title.className="title";this.title.width=40;this._nav_ny=f('<img id=objynext src="/js/calendar/images/ynext.gif">',1,2);this._nav_ny.width=25;this._nav_ny.ttip=Calendar._TT.NEXT_YEAR;this._nav_pm=f('<img id=objmprev src="/js/calendar/images/mprev.gif">',1,-1);this._nav_pm.width=25;this._nav_pm.ttip=Calendar._TT.PREV_MONTH;this.title2=f("",1,300);this.title2.className="title";this.title2.width=28;this._nav_nm=f('<img id=objmnext src="/js/calendar/images/mnext.gif">',1,1);this._nav_nm.width=25;this._nav_nm.ttip=Calendar._TT.NEXT_MONTH;if(this.isPopup){this.title.ttip=Calendar._TT.DRAG_TO_MOVE;var e=f('<img id=objclose src="/js/calendar/images/close.gif">',1,200);e.ttip=Calendar._TT.CLOSE;e.align="right"}g=Calendar.createElement("tr",t);g.className="daynames";if(this.weekNumbers){c=Calendar.createElement("td",g);c.className="name wn";c.appendChild(document.createTextNode(Calendar._TT.WK))}for(var r=7;r>0;--r){c=Calendar.createElement("td",g);c.appendChild(document.createTextNode(""));if(!r){c.navtype=100;c.calendar=this;Calendar._add_evs(c)}}this.firstdayname=(this.weekNumbers)?g.firstChild.nextSibling:g.firstChild;this._displayWeekdays();var a=Calendar.createElement("tbody",u);this.tbody=a;for(r=6;r>0;--r){g=Calendar.createElement("tr",a);if(this.weekNumbers){c=Calendar.createElement("td",g);c.appendChild(document.createTextNode(""))}for(var o=7;o>0;--o){c=Calendar.createElement("td",g);c.appendChild(document.createTextNode(""));c.calendar=this;Calendar._add_evs(c)}}var l=Calendar.createElement("tfoot",u);g=Calendar.createElement("tr",l);g.className="footrow";g.height=26;c=f(Calendar._TT.SEL_DATE,this.weekNumbers?8:7,300);c.className="ttip";if(this.isPopup){c.ttip=Calendar._TT.DRAG_TO_MOVE}this.tooltips=c;m=Calendar.createElement("div",this.element);this.monthsCombo=m;m.className="combo";for(r=0;r<Calendar._MN.length;++r){var q=Calendar.createElement("div");q.className="label";q.month=r;q.appendChild(document.createTextNode(Calendar._MN3[r]));m.appendChild(q)}m=Calendar.createElement("div",this.element);this.yearsCombo=m;m.className="combo";for(r=12;r>0;--r){var p=Calendar.createElement("div");p.className="label";p.appendChild(document.createTextNode(""));m.appendChild(p)}this._init(this.mondayFirst,this.date);d.appendChild(this.element)};Calendar._keyEvent=function(e){if(!window.calendar){return false}(Calendar.is_ie)&&(e=window.event);var g=window.calendar;var a=(Calendar.is_ie||e.type=="keypress");if(e.ctrlKey){switch(e.keyCode){case 37:a&&Calendar.cellClick(g._nav_pm);break;case 38:a&&Calendar.cellClick(g._nav_py);break;case 39:a&&Calendar.cellClick(g._nav_nm);break;case 40:a&&Calendar.cellClick(g._nav_ny);break;default:return false}}else{switch(e.keyCode){case 32:Calendar.cellClick(g._nav_now);break;case 27:a&&g.hide();break;case 37:case 38:case 39:case 40:if(a){var b=g.date.getDate()-1;var c=g.currentDateEl;var f=null;var d=(e.keyCode==37)||(e.keyCode==38);switch(e.keyCode){case 37:(--b>=0)&&(f=g.ar_days[b]);break;case 38:b-=7;(b>=0)&&(f=g.ar_days[b]);break;case 39:(++b<g.ar_days.length)&&(f=g.ar_days[b]);break;case 40:b+=7;(b<g.ar_days.length)&&(f=g.ar_days[b]);break}if(!f){if(d){Calendar.cellClick(g._nav_pm)}else{Calendar.cellClick(g._nav_nm)}b=(d)?g.date.getMonthDays():1;c=g.currentDateEl;f=g.ar_days[b-1]}Calendar.removeClass(c,"selected");Calendar.addClass(f,"selected");g.date.setDate(f.caldate);g.callHandler();g.currentDateEl=f}break;case 13:if(a){g.callHandler();g.hide()}break;default:return false}}return Calendar.stopEvent(e)};Calendar.prototype._init=function(f,s){var q=new Date();var h=s.getFullYear();if(h<this.minYear){h=this.minYear;s.setFullYear(h)}else{if(h>this.maxYear){h=this.maxYear;s.setFullYear(h)}}this.mondayFirst=f;this.date=new Date(s);var t=s.getMonth();var w=s.getDate();var u=s.getMonthDays();s.setDate(1);var k=s.getDay();var p=f?1:0;var c=f?5:6;var b=f?6:0;if(f){k=(k>0)?(k-1):6}var e=1;var d=this.tbody.firstChild;var l=Calendar._MN3[t];var g=((q.getFullYear()==h)&&(q.getMonth()==t));var m=q.getDate();var v=s.getWeekNumber();var r=new Array();for(var o=0;o<6;++o){if(e>u){d.className="emptyrow";d=d.nextSibling;continue}var a=d.firstChild;if(this.weekNumbers){a.className="day wn";a.firstChild.data=v;a=a.nextSibling}++v;d.className="daysrow";for(var n=0;n<7;++n){a.className="day";if((!o&&n<k)||e>u){a.innerHTML="&nbsp;";a.disabled=true;a=a.nextSibling;continue}a.disabled=false;a.firstChild.data=e;if(typeof this.checkDisabled=="function"){s.setDate(e);if(this.checkDisabled(s)){a.className+=" disabled";a.disabled=true}}if(!a.disabled){r[r.length]=a;a.caldate=e;a.ttip="_";if(e==w){a.className+=" selected";this.currentDateEl=a}if(g&&(e==m)){a.className+=" today";a.ttip+=Calendar._TT.PART_TODAY}if(k==c||k==b){a.className+=" weekend"}}++e;((++k)^7)||(k=0);a=a.nextSibling}d=d.nextSibling}this.ar_days=r;this.title.firstChild.data=h+"年";this.title2.firstChild.data=Calendar._MN[t]};Calendar.prototype.setDate=function(a){if(!a.equalsTo(this.date)){this._init(this.mondayFirst,a)}};Calendar.prototype.refresh=function(){this._init(this.mondayFirst,this.date)};Calendar.prototype.setMondayFirst=function(a){this._init(a,this.date);this._displayWeekdays()};Calendar.prototype.setDisabledHandler=function(a){this.checkDisabled=a};Calendar.prototype.setRange=function(b,c){this.minYear=b;this.maxYear=c};Calendar.prototype.callHandler=function(){if(this.onSelected){this.onSelected(this,this.date.print(this.dateFormat))}};Calendar.prototype.callCloseHandler=function(){if(this.onClose){this.onClose(this)}this.hideShowCovered()};Calendar.prototype.destroy=function(){var a=this.element.parentNode;a.removeChild(this.element);Calendar._C=null};Calendar.prototype.reparent=function(b){var a=this.element;a.parentNode.removeChild(a);b.appendChild(a)};Calendar._checkCalendar=function(b){if(!window.calendar){return false}var a=Calendar.is_ie?Calendar.getElement(b):Calendar.getTargetElement(b);for(;a!=null&&a!=calendar.element;a=a.parentNode){}if(a==null){window.calendar.callCloseHandler();return Calendar.stopEvent(b)}};Calendar.prototype.show=function(){var e=this.table.getElementsByTagName("tr");for(var d=e.length;d>0;){var f=e[--d];Calendar.removeClass(f,"rowhilite");var c=f.getElementsByTagName("td");for(var b=c.length;b>0;){var a=c[--b];Calendar.removeClass(a,"hilite");Calendar.removeClass(a,"active")}}this.element.style.display="block";this.hidden=false;if(this.isPopup){window.calendar=this;Calendar.addEvent(document,"keydown",Calendar._keyEvent);Calendar.addEvent(document,"keypress",Calendar._keyEvent);Calendar.addEvent(document,"mousedown",Calendar._checkCalendar)}this.hideShowCovered()};Calendar.prototype.hide=function(){if(this.isPopup){Calendar.removeEvent(document,"keydown",Calendar._keyEvent);Calendar.removeEvent(document,"keypress",Calendar._keyEvent);Calendar.removeEvent(document,"mousedown",Calendar._checkCalendar)}this.element.style.display="none";this.hidden=true;this.hideShowCovered()};Calendar.prototype.showAt=function(a,c){var b=this.element.style;b.left=a+"px";b.top=c+"px";this.show()};Calendar.prototype.showAtElement=function(e,f){var g=Calendar.getAbsolutePos(e);if(!f||typeof f!="string"){this.showAt(g.x,g.y+e.offsetHeight);return true}this.show();var b=this.element.offsetWidth;var d=this.element.offsetHeight;this.hide();var c=f.substr(0,1);var a="l";if(f.length>1){a=f.substr(1,1)}switch(c){case"T":g.y-=d;break;case"B":g.y+=e.offsetHeight;break;case"C":g.y+=(e.offsetHeight-d)/2;break;case"t":g.y+=e.offsetHeight-d;break;case"b":break}switch(a){case"L":g.x-=b;break;case"R":g.x+=e.offsetWidth;break;case"C":g.x+=(e.offsetWidth-b)/2;break;case"r":g.x+=e.offsetWidth-b;break;case"l":break}this.showAt(g.x,g.y)};Calendar.prototype.setDateFormat=function(a){this.dateFormat=a};Calendar.prototype.setTtDateFormat=function(a){this.ttDateFormat=a};Calendar.prototype.parseDate=function(l,c){var o=0;var e=-1;var h=0;var p=l.split(/\W+/);if(!c){c=this.dateFormat}var n=c.split(/\W+/);var g=0,f=0;for(g=0;g<p.length;++g){if(n[g]=="D"||n[g]=="DD"){continue}if(n[g]=="d"||n[g]=="dd"){h=parseInt(p[g],10)}if(n[g]=="m"||n[g]=="mm"){e=parseInt(p[g],10)-1}if((n[g]=="y")||(n[g]=="yy")){o=parseInt(p[g],10);(o<100)&&(o+=(o>29)?1900:2000)}if(n[g]=="M"||n[g]=="MM"){for(f=0;f<12;++f){if(Calendar._MN[f].substr(0,p[g].length).toLowerCase()==p[g].toLowerCase()){e=f;break}}}}if(o!=0&&e!=-1&&h!=0){this.setDate(new Date(o,e,h));return}o=0;e=-1;h=0;for(g=0;g<p.length;++g){if(p[g].search(/[a-zA-Z]+/)!=-1){var q=-1;for(f=0;f<12;++f){if(Calendar._MN[f].substr(0,p[g].length).toLowerCase()==p[g].toLowerCase()){q=f;break}}if(q!=-1){if(e!=-1){h=e+1}e=q}}else{if(parseInt(p[g],10)<=12&&e==-1){e=p[g]-1}else{if(parseInt(p[g],10)>31&&o==0){o=parseInt(p[g],10);(o<100)&&(o+=(o>29)?1900:2000)}else{if(h==0){h=p[g]}}}}}if(o==0){var k=new Date();o=k.getFullYear()}if(e!=-1&&h!=0){this.setDate(new Date(o,e,h))}};Calendar.prototype.hideShowCovered=function(){function o(p,i){var k=p.style[i];if(!k){if(document.defaultView&&typeof(document.defaultView.getComputedStyle)=="function"){k=document.defaultView.getComputedStyle(p,"").getPropertyValue(i)}else{if(p.currentStyle){k=p.currentStyle[i]}else{k=p.style[i]}}}return k}var s=new Array("applet","select");var b=this.element;var a=Calendar.getAbsolutePos(b);var e=a.x;var c=b.offsetWidth+e;var r=a.y;var q=b.offsetHeight+r;for(var g=s.length;g>0;){var f=document.getElementsByTagName(s[--g]);var d=null;for(var j=f.length;j>0;){d=f[--j];a=Calendar.getAbsolutePos(d);var n=a.x;var m=d.offsetWidth+n;var l=a.y;var h=d.offsetHeight+l;if(this.hidden||(n>c)||(m<e)||(l>q)||(h<r)){if(!d.__msh_save_visibility){d.__msh_save_visibility=o(d,"visibility")}d.style.visibility=d.__msh_save_visibility}else{if(!d.__msh_save_visibility){d.__msh_save_visibility=o(d,"visibility")}d.style.visibility="hidden"}}}};Calendar.prototype._displayWeekdays=function(){var c=this.mondayFirst?0:1;var b=this.mondayFirst?6:0;var e=this.mondayFirst?5:6;var a=this.firstdayname;for(var d=0;d<7;++d){a.className="day name";if(!d){a.ttip=this.mondayFirst?Calendar._TT.SUN_FIRST:Calendar._TT.MON_FIRST;a.navtype=100;a.calendar=this;Calendar._add_evs(a)}if(d==b||d==e){Calendar.addClass(a,"weekend")}a.firstChild.data=Calendar._DN3[d+1-c];a=a.nextSibling}};Calendar.prototype._hideCombos=function(){this.monthsCombo.style.display="none";this.yearsCombo.style.display="none"};Calendar.prototype._dragStart=function(ev){if(this.dragging){return}this.dragging=false;var posX;var posY;if(Calendar.is_ie){posY=window.event.clientY+document.body.scrollTop;posX=window.event.clientX+document.body.scrollLeft}else{posY=ev.clientY+window.scrollY;posX=ev.clientX+window.scrollX}var st=this.element.style;this.xOffs=posX-parseInt(st.left);this.yOffs=posY-parseInt(st.top);with(Calendar){addEvent(document,"mouseover",stopEvent);addEvent(document,"mouseup",calDragEnd)}};Date._MD=new Array(31,28,31,30,31,30,31,31,30,31,30,31);Date.SECOND=1000;Date.MINUTE=60*Date.SECOND;Date.HOUR=60*Date.MINUTE;Date.DAY=24*Date.HOUR;Date.WEEK=7*Date.DAY;Date.prototype.getMonthDays=function(b){var a=this.getFullYear();if(typeof b=="undefined"){b=this.getMonth()}if(((0==(a%4))&&((0!=(a%100))||(0==(a%400))))&&b==1){return 29}else{return Date._MD[b]}};Date.prototype.getWeekNumber=function(){var b=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0);var d=new Date(this.getFullYear(),0,1,0,0,0);var c=b-d;var a=d.getDay();(a>3)&&(a-=4)||(a+=3);return Math.round(((c/Date.DAY)+a)/7)};Date.prototype.equalsTo=function(a){return((this.getFullYear()==a.getFullYear())&&(this.getMonth()==a.getMonth())&&(this.getDate()==a.getDate()))};Date.prototype.print=function(frm){var str=new String(frm);var m=this.getMonth();var d=this.getDate();var y=this.getFullYear();var wn=this.getWeekNumber();var w=this.getDay();var s=new Array();s.d=d;s.dd=(d<10)?("0"+d):d;s.m=1+m;s.mm=(m<9)?("0"+(1+m)):(1+m);s.y=y;s.yy=new String(y).substr(2,2);s.w=wn;s.ww=(wn<10)?("0"+wn):wn;with(Calendar){s.D=_DN3[w];s.DD=_DN[w];s.M=_MN3[m];s.MM=_MN[m]}var re=/(.*)(\W|^)(d|dd|m|mm|y|yy|MM|M|DD|D|w|ww)(\W|$)(.*)/;while(re.exec(str)!=null){str=RegExp.$1+RegExp.$2+s[RegExp.$3]+RegExp.$4+RegExp.$5}return str};window.calendar=null;
/*时间语言*/
Calendar._DN=new Array("日","一","二","三","四","五","六","日");Calendar._MN=new Array("1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月");Calendar._TT={};Calendar._TT.TOGGLE="切换周显示方式";Calendar._TT.PREV_YEAR="上一年 (按住鼠标出下拉菜单)";Calendar._TT.PREV_MONTH="上一月 (按住鼠标出下拉菜单)";Calendar._TT.GO_TODAY="到今日";Calendar._TT.NEXT_MONTH="下一月 (按住鼠标出下拉菜单)";Calendar._TT.NEXT_YEAR="下一年 (按住鼠标出下拉菜单)";Calendar._TT.SEL_DATE="选择日期";Calendar._TT.DRAG_TO_MOVE="拖动";Calendar._TT.DRAG_TO_MOVE="";Calendar._TT.PART_TODAY=" (今日)";Calendar._TT.MON_FIRST="首先显示星期一";Calendar._TT.SUN_FIRST="首先显示星期日";Calendar._TT.CLOSE="关闭";Calendar._TT.TODAY="今日";Calendar._TT.DEF_DATE_FORMAT="y-mm-dd";Calendar._TT.TT_DATE_FORMAT="D, y M d";Calendar._TT.WK="周";
/*时间插件设置*/
var oldLink=null;function setActiveStyleSheet(e,t){var l,a;for(l=0;a=document.getElementsByTagName("link")[l];l++)-1!=a.getAttribute("rel").indexOf("style")&&a.getAttribute("title")&&(a.disabled=!0,a.getAttribute("title")==t&&(a.disabled=!1));return oldLink&&(oldLink.style.fontWeight="normal"),oldLink=e,e.style.fontWeight="bold",!1}function selected(e,t){e.sel.value=t,!e.dateClicked||"sel1"!=e.sel.id&&"sel3"!=e.sel.id||e.callCloseHandler()}function closeHandler(e){e.hide()}function showCalendar(e,t){var l=document.getElementById(e);if(null!=calendar)calendar.hide();else{var a=new Calendar(!1,null,selected,closeHandler);calendar=a,a.setRange(1900,2200),a.create()}return calendar.setDateFormat(t),calendar.parseDate(l.value),calendar.sel=l,calendar.showAtElement(l,"Br"),!1}var MINUTE=6e4,HOUR=60*MINUTE,DAY=24*HOUR,WEEK=7*DAY;function isDisabled(e){var t=new Date;return Math.abs(e.getTime()-t.getTime())/DAY>10}function flatSelected(e,t){document.getElementById("preview").innerHTML=t}function showFlatCalendar(){var e=document.getElementById("display"),t=new Calendar(!1,null,flatSelected);t.weekNumbers=!1,t.setDisabledHandler(isDisabled),t.setDateFormat("DD, M d"),t.create(e),t.show()}
/*表单的各种事件*/
//自定义表单JS
function getCity(type, id){
    var provinceCode = $('#province_'+id).val();
    var url = "/dom/ajax_form.php?ajax=1&code=" + provinceCode + "&fieldId=" + id + "&type=" + type;
    $.get(url,function(data){
        if(data){
            $('#cityList_'+id).html(data);
        }
    })
}
function getDistrict(id){
    var cityCode = $('#city_'+id).val();
    var url = "/dom/ajax_form.php?ajax=2&cityCode=" + cityCode + "&fieldId=" + id;
    $.get(url, function(data){
        $('#districtList_'+id).html(data);
    })
}

function getP(id){
    var province = $('#province_'+id+' option:selected').html();
    $('#field_'+id).val(province);
}
function getC(id){
    var city = $('#city_'+id+' option:selected').html();
    city = city.replace('&nbsp;&nbsp;|--','');
    $('#field_'+id).val(city);
}
function getPC(id){
    var province = $('#province_'+id+' option:selected').html();
    var city = $('#city_'+id+' option:selected').html();
    $('#field_'+id).val(province + '#' + city);
}
function getPCD(id){
    var province = $('#province_'+id+' option:selected').html();
    var city = $('#city_'+id+' option:selected').html();
    var district = $('#district_'+id+' option:selected').html();
    $('#field_'+id).val(province + '#' + city + '#' + district);
}

function fileChange(target) {
    var isIE = /msie/i.test(navigator.userAgent) && !window.opera;
    var fileName = target.value;
    var extend =fileName.substr(fileName.lastIndexOf(".")).toLowerCase();
    var AllowExt=".jpg|.jpeg|.gif|.png|.zip|.rar|.docx|.doc|.txt|";
    if(AllowExt!=0 && AllowExt.indexOf(extend+"|")==-1){
        alert('仅支持上传图片、WORD文档、记事本、压缩包格式的文件!不超过1M');
        target.value='';
        return false;
    }
    var fileSize = 0;
    if (isIE && !target.files){
        var fileSystem = new ActiveXObject("Scripting.FileSystemObject");
        var file = fileSystem.GetFile (filePath);
        fileSize = file.Size;
    } else {
        fileSize = target.files[0].size;
        console.log(fileSize);
    }
    var size = fileSize / 1024;
    if(size>1000){
        alert("附件不能大于1M");
    }
}
function getRadioVal(id){
    var name = '#radio_'+id;
    var index = $(name+':checked').val();
    var html = $(name+' +span:eq('+index+')').html();
    if(-1 != html.indexOf('&nbsp;&nbsp;')){
        html = html.replace('&nbsp;&nbsp;', '');
        $('#field_'+id).val(html);
    }
}
function getSelectVal(id){
    var name = '#select_'+id;
    var index = parseInt($(name).val()) + 1;
    var html = $(name+' option:eq('+index+')').html();
    $('#field_'+id).val(html);
}
function getCheckboxVal(id){
    var name = 'checkbox_'+id+'[]';
    var str = '';
    $("input[name='"+name+"']:checked").each(function(){
        str += $(this).val()+'#*#';
    });
    str = str.substr(str, str.lastIndexOf('#*#'));
    $('#field_'+id).val(str);
}

function getVcode2(){
    var date=new Date();
    document.getElementById("vcodesrc").src="/include/captcha/captcha.php?datete="+date.getTime();
}
